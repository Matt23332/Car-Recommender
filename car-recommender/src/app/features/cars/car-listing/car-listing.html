<div class="car-listing-page">
  <app-navbar></app-navbar>
  <!-- Header -->
  <div class="page-header">
    <div class="container">
      <h1 class="page-title">Find Your Perfect Car</h1>
      <p class="page-description">Choose from our wide selection of premium vehicles</p>
    </div>
  </div>

  <div class="container">
    <div class="listing-layout">
      <!-- Sidebar Filters -->
      <aside class="filters-sidebar" [class.show]="showFilters">
        <div class="filters-header">
          <h2 class="filters-title">Filters</h2>
          <button class="btn-reset" (click)="resetFilters()">Reset All</button>
        </div>

        <!-- Search -->
        <div class="filter-group">
          <label class="filter-label">Search</label>
          <div class="search-box">
            <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <input 
              type="text"
              [(ngModel)]="filters.searchQuery"
              (ngModelChange)="onSearchChange($event)"
              class="search-input"
              placeholder="Search by make, model...">
          </div>
        </div>

        <!-- Price Range -->
        <div class="filter-group">
          <label class="filter-label">
            Price Range: ${{ filters.minPrice }} - ${{ filters.maxPrice }}/day
          </label>
          <div class="range-inputs">
            <input 
              type="range"
              [(ngModel)]="filters.minPrice"
              (ngModelChange)="onFilterChange()"
              min="0"
              max="500"
              class="range-slider">
            <input 
              type="range"
              [(ngModel)]="filters.maxPrice"
              (ngModelChange)="onFilterChange()"
              min="0"
              max="500"
              class="range-slider">
          </div>
        </div>

        <!-- Car Type -->
        <div class="filter-group">
          <label class="filter-label">Car Type</label>
          <select 
            [(ngModel)]="filters.type"
            (ngModelChange)="onFilterChange()"
            class="filter-select">
            <option *ngFor="let type of carTypes" [value]="type">
              {{ type | titlecase }}
            </option>
          </select>
        </div>

        <!-- Transmission -->
        <div class="filter-group">
          <label class="filter-label">Transmission</label>
          <select 
            [(ngModel)]="filters.transmission"
            (ngModelChange)="onFilterChange()"
            class="filter-select">
            <option *ngFor="let trans of transmissions" [value]="trans">
              {{ trans | titlecase }}
            </option>
          </select>
        </div>

        <!-- Fuel Type -->
        <div class="filter-group">
          <label class="filter-label">Fuel Type</label>
          <select 
            [(ngModel)]="filters.fuelType"
            (ngModelChange)="onFilterChange()"
            class="filter-select">
            <option *ngFor="let fuel of fuelTypes" [value]="fuel">
              {{ fuel | titlecase }}
            </option>
          </select>
        </div>

        <!-- Seats -->
        <div class="filter-group">
          <label class="filter-label">Seats</label>
          <select 
            [(ngModel)]="filters.seats"
            (ngModelChange)="onFilterChange()"
            class="filter-select">
            <option *ngFor="let seat of seatsOptions" [value]="seat">
              {{ seat === 'all' ? 'All' : seat + ' Seats' }}
            </option>
          </select>
        </div>

        <!-- Location -->
        <div class="filter-group">
          <label class="filter-label">Location</label>
          <select 
            [(ngModel)]="filters.location"
            (ngModelChange)="onFilterChange()"
            class="filter-select">
            <option value="">All Locations</option>
            <option *ngFor="let loc of locations" [value]="loc">
              {{ loc }}
            </option>
          </select>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="listing-main">
        <!-- Toolbar -->
        <div class="toolbar">
          <div class="toolbar-left">
            <button class="btn-filter-toggle" (click)="toggleFilters()">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
              </svg>
              Filters
            </button>
            <span class="results-count">
              {{ filteredCars.length }} {{ filteredCars.length === 1 ? 'Car' : 'Cars' }} Found
            </span>
          </div>

          <div class="toolbar-right">
            <select 
              [(ngModel)]="filters.sortBy"
              (ngModelChange)="onFilterChange()"
              class="sort-select">
              <option *ngFor="let option of sortOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>

            <div class="view-toggle">
              <button 
                (click)="viewMode = 'grid'"
                [class.active]="viewMode === 'grid'"
                class="view-btn">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
              </button>
              <button 
                (click)="viewMode = 'list'"
                [class.active]="viewMode === 'list'"
                class="view-btn">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="M4 6h16M4 12h16M4 18h16" />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-state">
          <div class="spinner"></div>
          <p>Loading amazing cars...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && filteredCars.length === 0" class="empty-state">
          <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <h3>No cars found</h3>
          <p>Try adjusting your filters to see more results</p>
          <button (click)="resetFilters()" class="btn-primary">Reset Filters</button>
        </div>

        <!-- Car Grid/List -->
        <div *ngIf="!loading && filteredCars.length > 0" 
             class="cars-container"
             [class.grid-view]="viewMode === 'grid'"
             [class.list-view]="viewMode === 'list'">
          
          <div *ngFor="let car of paginatedCars" class="car-card">
            <div class="car-image-wrapper">
              <img [src]="car.images[0]" [alt]="car.make + ' ' + car.model" class="car-image">
              <div class="car-badge" *ngIf="car.rating >= 4.8">Top Rated</div>
              <button class="btn-favorite">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              </button>
            </div>

            <div class="car-content">
              <div class="car-header">
                <div>
                  <h3 class="car-name">{{ car.make }} {{ car.model }}</h3>
                  <p class="car-details">
                    {{ car.year }} • {{ car.type | titlecase }} • {{ car.transmission | titlecase }}
                  </p>
                </div>
                <div class="car-rating">
                  <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                  <span class="rating-value">{{ car.rating }}</span>
                  <span class="rating-count">({{ car.numberOfRatings }})</span>
                </div>
              </div>

              <div class="car-specs">
                <div class="spec-item">
                  <svg class="spec-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                  <span>{{ car.seats }} Seats</span>
                </div>
                <div class="spec-item">
                  <svg class="spec-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  <span>{{ car.fuelType | titlecase }}</span>
                </div>
                <div class="spec-item">
                  <svg class="spec-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  </svg>
                  <span>{{ car.location }}</span>
                </div>
              </div>

              <div class="car-features">
                <span *ngFor="let feature of car.features.slice(0, 3)" class="feature-badge">
                  {{ feature }}
                </span>
              </div>

              <div class="car-footer">
                <div class="car-price">
                  <span class="price-amount">${{ car.pricePerDay }}</span>
                  <span class="price-period">/day</span>
                </div>
                <div class="car-actions">
                  <button (click)="viewCarDetails(car.id)" class="btn-view">View Details</button>
                  <button (click)="bookCar(car.id)" class="btn-book">Book Now</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div *ngIf="!loading && filteredCars.length > 0" class="pagination">
          <button 
            (click)="goToPage(currentPage - 1)"
            [disabled]="currentPage === 1"
            class="pagination-btn">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>

          <button 
            *ngFor="let page of getPaginationPages()"
            (click)="goToPage(page)"
            [class.active]="page === currentPage"
            class="pagination-number">
            {{ page }}
          </button>

          <button 
            (click)="goToPage(currentPage + 1)"
            [disabled]="currentPage === totalPages"
            class="pagination-btn">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </main>
    </div>
  </div>
</div>