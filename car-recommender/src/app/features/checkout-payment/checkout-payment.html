<div class="checkout-page">
  <div class="container">
    <!-- Header -->
    <div class="checkout-header">
      <h1 class="page-title">Complete Your Booking</h1>
      <p class="page-subtitle">{{ calculateTotalDays() }} days • {{ bookingDetails.pickupLocation }}</p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
        <div class="step-circle" (click)="goToStep(1)">
          <span *ngIf="currentStep > 1">✓</span>
          <span *ngIf="currentStep <= 1">1</span>
        </div>
        <span class="step-label">Contact Info</span>
      </div>
      <div class="step-line" [class.completed]="currentStep > 1"></div>
      <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
        <div class="step-circle" (click)="goToStep(2)">
          <span *ngIf="currentStep > 2">✓</span>
          <span *ngIf="currentStep <= 2">2</span>
        </div>
        <span class="step-label">Payment</span>
      </div>
      <div class="step-line" [class.completed]="currentStep > 2"></div>
      <div class="step" [class.active]="currentStep >= 3">
        <div class="step-circle">3</div>
        <span class="step-label">Confirmation</span>
      </div>
    </div>

    <!-- Main Content -->
    <div class="checkout-content">
      <!-- Left Column -->
      <div class="checkout-main">
        
        <!-- STEP 1: Contact Information -->
        <div *ngIf="currentStep === 1" class="checkout-section">
          <h2 class="section-title">Contact Information</h2>
          <div class="form-grid">
            <div class="form-group full-width">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-input" [(ngModel)]="contactForm.fullName" placeholder="John Smith">
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" [(ngModel)]="contactForm.email" placeholder="john@example.com">
            </div>
            <div class="form-group">
              <label class="form-label">Phone</label>
              <input type="tel" class="form-input" [(ngModel)]="contactForm.phone" placeholder="+1 (555) 123-4567">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Driver's License Number</label>
              <input type="text" class="form-input" [(ngModel)]="contactForm.licenseNumber" placeholder="DL123456789">
            </div>
          </div>

          <div class="section-divider"></div>

          <h3 class="subsection-title">Pickup & Return Details</h3>
          <div class="details-grid">
            <div class="detail-card">
              <svg class="detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <div>
                <span class="detail-label">Pickup</span>
                <span class="detail-value">{{ bookingDetails.pickupDate | date:'MMM d, yyyy' }}</span>
              </div>
            </div>
            <div class="detail-card">
              <svg class="detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <div>
                <span class="detail-label">Return</span>
                <span class="detail-value">{{ bookingDetails.returnDate | date:'MMM d, yyyy' }}</span>
              </div>
            </div>
            <div class="detail-card full-width">
              <svg class="detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              </svg>
              <div>
                <span class="detail-label">Location</span>
                <span class="detail-value">{{ bookingDetails.pickupLocation }}</span>
              </div>
            </div>
          </div>

          <div class="step-actions">
            <button class="btn-next" (click)="nextStep()">Continue to Payment</button>
          </div>
        </div>

        <!-- STEP 2: Payment -->
        <div *ngIf="currentStep === 2" class="checkout-section">
          <h2 class="section-title">Payment Method</h2>
          
          <div class="payment-methods">
            <div *ngFor="let method of paymentMethods" 
                 class="payment-method" 
                 [class.selected]="selectedPaymentMethod === method.type"
                 (click)="selectedPaymentMethod = method.type">
              <div class="method-radio">
                <div class="radio-outer">
                  <div class="radio-inner" *ngIf="selectedPaymentMethod === method.type"></div>
                </div>
              </div>
              <svg class="method-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path *ngIf="method.type === 'card'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                <path *ngIf="method.type === 'paypal'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              <span class="method-label">{{ method.label }}</span>
            </div>
          </div>

          <!-- Card Form -->
          <div *ngIf="selectedPaymentMethod === 'card'" class="payment-form">
            <div class="form-group full-width">
              <label class="form-label">Card Number</label>
              <input type="text" 
                     class="form-input" 
                     [(ngModel)]="cardForm.cardNumber"
                     (ngModelChange)="formatCardNumber(cardForm.cardNumber)"
                     placeholder="1234 5678 9012 3456"
                     maxlength="19">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Cardholder Name</label>
              <input type="text" class="form-input" [(ngModel)]="cardForm.cardHolderName" placeholder="JOHN SMITH">
            </div>
            <div class="form-group">
              <label class="form-label">Expiry Date</label>
              <input type="text" 
                     class="form-input" 
                     [(ngModel)]="cardForm.expiryDate"
                     (ngModelChange)="formatExpiryDate(cardForm.expiryDate)"
                     placeholder="MM/YY"
                     maxlength="5">
            </div>
            <div class="form-group">
              <label class="form-label">CVV</label>
              <input type="text" class="form-input" [(ngModel)]="cardForm.cvv" placeholder="123" maxlength="4">
            </div>
          </div>

          <!-- PayPal -->
          <div *ngIf="selectedPaymentMethod === 'paypal'" class="paypal-info">
            <p>You will be redirected to PayPal to complete your payment securely.</p>
          </div>

          <div class="section-divider"></div>

          <div class="terms-checkbox">
            <input type="checkbox" id="terms" [(ngModel)]="agreedToTerms" class="checkbox">
            <label for="terms">
              I agree to the <a href="#" class="link">Terms and Conditions</a> and <a href="#" class="link">Privacy Policy</a>
            </label>
          </div>

          <div class="step-actions">
            <button class="btn-back" (click)="previousStep()">Back</button>
            <button class="btn-next" (click)="nextStep()" [disabled]="!agreedToTerms">Review Booking</button>
          </div>
        </div>

        <!-- STEP 3: Review & Confirm -->
        <div *ngIf="currentStep === 3 && !bookingConfirmed" class="checkout-section">
          <h2 class="section-title">Review Your Booking</h2>

          <div class="review-section">
            <h3 class="review-heading">Contact Information</h3>
            <div class="review-grid">
              <div class="review-item"><span class="review-label">Name:</span><span>{{ contactForm.fullName }}</span></div>
              <div class="review-item"><span class="review-label">Email:</span><span>{{ contactForm.email }}</span></div>
              <div class="review-item"><span class="review-label">Phone:</span><span>{{ contactForm.phone }}</span></div>
              <div class="review-item"><span class="review-label">License:</span><span>{{ contactForm.licenseNumber }}</span></div>
            </div>
          </div>

          <div class="review-section">
            <h3 class="review-heading">Booking Details</h3>
            <div class="review-grid">
              <div class="review-item"><span class="review-label">Pickup:</span><span>{{ bookingDetails.pickupDate | date:'MMM d, yyyy' }}</span></div>
              <div class="review-item"><span class="review-label">Return:</span><span>{{ bookingDetails.returnDate | date:'MMM d, yyyy' }}</span></div>
              <div class="review-item"><span class="review-label">Location:</span><span>{{ bookingDetails.pickupLocation }}</span></div>
              <div class="review-item"><span class="review-label">Duration:</span><span>{{ calculateTotalDays() }} days</span></div>
            </div>
          </div>

          <div class="review-section">
            <h3 class="review-heading">Payment Method</h3>
            <div class="review-payment">
              <svg class="payment-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
              </svg>
              <span *ngIf="selectedPaymentMethod === 'card'">•••• •••• •••• {{ cardForm.cardNumber.slice(-4) }}</span>
              <span *ngIf="selectedPaymentMethod === 'paypal'">PayPal</span>
            </div>
          </div>

          <div class="confirmation-warning">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p>By confirming, you authorize us to charge your payment method for the total amount.</p>
          </div>

          <div class="step-actions">
            <button class="btn-back" (click)="previousStep()">Back</button>
            <button class="btn-confirm" (click)="confirmBooking()" [disabled]="isProcessing">
              <span *ngIf="!isProcessing">Confirm & Pay ${{ calculateGrandTotal() | number:'1.2-2' }}</span>
              <span *ngIf="isProcessing">Processing...</span>
            </button>
          </div>
        </div>

        <!-- CONFIRMATION SUCCESS -->
        <div *ngIf="bookingConfirmed" class="confirmation-success">
          <div class="success-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h2 class="success-title">Booking Confirmed!</h2>
          <p class="success-subtitle">Your confirmation number is</p>
          <div class="confirmation-number">{{ confirmationNumber }}</div>
          <p class="success-message">
            A confirmation email has been sent to <strong>{{ contactForm.email }}</strong>
          </p>
          <div class="success-actions">
            <button class="btn-download" (click)="downloadConfirmation()">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Download Confirmation
            </button>
            <button class="btn-dashboard" (click)="goToDashboard()">Go to Dashboard</button>
          </div>
        </div>
      </div>

      <!-- Right Column - Order Summary -->
      <aside class="order-summary">
        <h3 class="summary-title">Order Summary</h3>
        
        <div class="summary-car" *ngIf="car">
          <img [src]="car.image" [alt]="car.make" class="summary-car-image">
          <div class="summary-car-info">
            <h4>{{ car.make }} {{ car.model }}</h4>
            <p>{{ car.type }}</p>
          </div>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-details">
          <div class="summary-row">
            <span>Car Rental ({{ calculateTotalDays() }} days)</span>
            <span>${{ calculateCarTotal() | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row" *ngIf="bookingDetails.addOns.insurance">
            <span>Insurance</span>
            <span>${{ addOnPrices.insurance * calculateTotalDays() | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row" *ngIf="bookingDetails.addOns.gps">
            <span>GPS Navigation</span>
            <span>${{ addOnPrices.gps * calculateTotalDays() | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row" *ngIf="bookingDetails.addOns.childSeat">
            <span>Child Seat</span>
            <span>${{ addOnPrices.childSeat * calculateTotalDays() | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row" *ngIf="bookingDetails.addOns.additionalDriver">
            <span>Additional Driver</span>
            <span>${{ addOnPrices.additionalDriver * calculateTotalDays() | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row">
            <span>Taxes & Fees</span>
            <span>${{ calculateTaxes() | number:'1.2-2' }}</span>
          </div>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-total">
          <span>Total</span>
          <span>${{ calculateGrandTotal() | number:'1.2-2' }}</span>
        </div>

        <div class="summary-note">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <p>Free cancellation up to 24 hours before pickup</p>
        </div>
      </aside>
    </div>
  </div>
</div>